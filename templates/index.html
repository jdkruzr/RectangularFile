<!DOCTYPE html>
<html>
<head>
    <title>File Monitor (CephFS Compatible)</title>
    <style>
        /* Existing styles... */
        
        /* Animation for removing files */
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; height: 0; padding: 0; margin: 0; border: 0; }
        }
        
        .removing {
            animation: fadeOut 1s forwards;
            background-color: #ffebee;
        }
    </style>
</head>
<body>
    <!-- Existing HTML... -->
    
    <script>
        // Poll for new files every 5 seconds (client-side polling)
        setInterval(function() {
            fetch('/new_files')
                .then(response => response.json())
                .then(data => {
                    // Handle new files
                    if (data.new_files && data.new_files.length > 0) {
                        updateFileList(data.new_files);
                    }
                    
                    // Handle removed files
                    if (data.removed_files && data.removed_files.length > 0) {
                        removeFilesFromList(data.removed_files);
                    }
                });
        }, 5000);
        
        // Setup manual scan button
        document.getElementById('scanButton').addEventListener('click', function() {
            this.textContent = 'Scanning...';
            this.disabled = true;
            
            fetch('/scan')
                .then(response => response.json())
                .then(data => {
                    // Handle new files
                    updateFileList(data.new_files);
                    
                    // Handle removed files
                    removeFilesFromList(data.removed_files);
                    
                    this.textContent = 'Scan Now';
                    this.disabled = false;
                })
                .catch(error => {
                    console.error('Error:', error);
                    this.textContent = 'Scan Now';
                    this.disabled = false;
                });
        });
        
        // Settings form handler...
        
        function updateFileList(newFiles) {
            if (newFiles.length > 0) {
                const fileList = document.getElementById('fileList');
                const notification = document.getElementById('notification');
                
                // Add new files to the list
                newFiles.forEach(file => {
                    // Check if the file is already in the list
                    let fileExists = false;
                    for (let i = 0; i < fileList.children.length; i++) {
                        if (fileList.children[i].textContent.trim() === file) {
                            fileExists = true;
                            break;
                        }
                    }
                    
                    // Only add if it doesn't exist yet
                    if (!fileExists) {
                        const li = document.createElement('li');
                        li.textContent = file;
                        fileList.appendChild(li);
                    }
                });
                
                // Show notification
                notification.textContent = `${newFiles.length} new file(s) detected!`;
                notification.style.display = 'block';
                
                // Hide notification after 3 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                }, 3000);
            }
        }
        
        function removeFilesFromList(removedFiles) {
            if (removedFiles.length > 0) {
                const fileList = document.getElementById('fileList');
                const notification = document.getElementById('notification');
                
                // Remove files from the list with animation
                removedFiles.forEach(file => {
                    for (let i = 0; i < fileList.children.length; i++) {
                        const listItem = fileList.children[i];
                        if (listItem.textContent.trim() === file) {
                            // Add the animation class
                            listItem.classList.add('removing');
                            
                            // Remove the element after animation completes
                            setTimeout(() => {
                                listItem.remove();
                            }, 1000);
                            break;
                        }
                    }
                });
                
                // Show notification
                notification.textContent = `${removedFiles.length} file(s) removed!`;
                notification.style.display = 'block';
                notification.style.borderLeftColor = '#dc3545';  // Red border for removal
                
                // Hide notification after 3 seconds
                setTimeout(() => {
                    notification.style.display = 'none';
                    notification.style.borderLeftColor = '#28a745';  // Reset to green
                }, 3000);
            }
        }
    </script>
</body>
</html>