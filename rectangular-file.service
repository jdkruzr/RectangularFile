[Unit]
Description=Rectangular File - Handwriting Recognition Document Manager
After=network.target

[Service]
User=sysop
Group=sysop
WorkingDirectory=/home/sysop/RectangularFile
ExecStart=/home/sysop/RectangularFile/venv/bin/gunicorn -w 1 -b 0.0.0.0:5000 --timeout 120 --access-logfile - --error-logfile - main:app
Restart=on-failure

# Authentication (Required)
Environment=SECRET_KEY=[your generated key here]
Environment=APP_PASSWORD_HASH=[your generated password hash here]

# File Storage Paths
Environment=UPLOAD_FOLDER=/mnt/onyx
Environment=DATABASE_PATH=/mnt/rectangularfile/pdf_index.db

# Model Configuration
Environment=MODEL_NAME=Qwen/Qwen2.5-VL-7B-Instruct
Environment=MODEL_CACHE_DIR=/mnt/rectangularfile/qwencache

# Debug/Logging
Environment=DEBUG_IMAGES_DIR=/mnt/rectangularfile/debug_images

# Processing Configuration
Environment=POLLING_INTERVAL=30.0

# System PATH (add poppler-utils)
Environment=PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin

# Flask Server (optional - can be overridden)
# Environment=FLASK_HOST=0.0.0.0
# Environment=FLASK_PORT=5000
# Environment=FLASK_DEBUG=false

[Install]
WantedBy=multi-user.target